<apex:page controller="QuotaAttainmentController">
    <style>
    html, body, p, .achieved { 
        font-family: "ProximaNovaSoft-Regular", Calibri, 
            "Gill Sans", "Gill Sans MT", Candara, Segoe, 
            "Segoe UI", Arial, sans-serif, "Arial Unicode MS"; 
        font-size: 110%;
    }
    input { font-size: 95%; }
    .graph {
        width:240px; height:200px;
        display: inline-block;
        margin: 1em;
    }
 
	</style>
        <apex:stylesheet value="{!URLFOR($Resource.OneStarter,'icons.css')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.OneStarter,'styles.css')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.OneStarter,'OneStarter.css')}"/>

	<!-- JavaScript files -->
	<apex:includeScript value="{!$Resource.jquery}"/>
	<apex:includeScript value="{!URLFOR($Resource.TouchSwipe,'jquery.touchSwipe.min.js')}"/>
	<apex:includeScript value="{!URLFOR($Resource.OneStarter,'jquery.onestarter.js')}"/>
	<apex:includeScript value="/canvas/sdk/js/publisher.js"/>    
	<!-- Needed for the gauage chart -->
    <apex:includeScript value="{!$Resource.raphael}"/>
    <apex:includeScript value="{!$Resource.justgage}"/>
        
    <div id="one-app">        
	    <div id="one-carousel">
            <apex:repeat value="{!attainments}" var="c" id="theRepeat">
                <div>
                    <div class="graph" id="{!c.forecastTypeStr}-{!c.category}">    
                    </div>
                    <article>
                        <header><h1>Opportunities in {!c.category}</h1>
<!--                            <a href="javascript:void(0)" title="More" class="link-right">
                              <span class="link-label">More</span>
                              <span class="link-icon-right icon-utility-right"></span>
                            </a>
-->
                        </header>
                        	<apex:repeat value="{!c.relatedOpptys}" var="opp">
                            <section class="padded">
                                <a href="javascript:sforce.one.navigateToSObject('{!opp.Id}')">
                                    <div class="icon icon-right icon-float-right icon--opportunity"></div>
                                    <h1 class="simple-bold">{!opp.Account.Name}</h1>
                                    <ul class="list-plain">
                                        <li ><apex:outputField value="{!opp.amount}"/></li>
                                        <li >{!opp.Name}</li>
                                    </ul>
                                </a>
                            </section>
                        	</apex:repeat>    
                	</article>

                </div>
            </apex:repeat>
            
        </div>
            
    </div>

    <script>
    
    	var startfunction = function() {
            var graphs = [];
            var amount;
            var quota;
            <apex:repeat value="{!attainments}" var="c" id="theRepeat2">
            amount = {!c.amount};
          	quota = {!c.quota};
            if (amount >= quota) {
                var theDiv = document.getElementById("{!c.forecastTypeStr}-{!c.category}");
                theDiv.innerHTML = "<p>{!c.category}&nbsp<br/>{!c.forecastTypeStr}<br/>" + 
                    			   "<div><em>Congratulations! Quota met!</em>" + 
                    			   "+$" + (amount-quota) + "</div></p>";
            }
            else {
                graphs.push(
                new JustGage({
                    id: "{!c.forecastTypeStr}-{!c.category}", 
                    value: amount,
                    min: 0,
                    max: quota,
                    label: "{!c.forecastTypeStr}",
                    formatNumber: true,
                    levelColors: [ "#ff0000", "#f9c802", "#a9d70b" ],
                    title: "{!c.category}"
                }));
            }
            </apex:repeat>
            
            var s1 = $('div#one-app').oneStarter('app');
            s1.carousel($('div#one-carousel'));
        }

        $(document).ready(startfunction);
    
    	function refreshCarousel() {
            startfunction();
        }
    
    	
    
    </script>
</apex:page>